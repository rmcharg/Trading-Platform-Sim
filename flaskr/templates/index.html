{% extends "layout.html" %}

{% block main %}
    <h3> Portfolio Summary </h3>
    <div class="container">
        <div class="row justify-content-md-center">
            <div class="card bg-dark mb-3 mx-3" style="max-width: 18rem;">
                <div class="card-body">
                    <h5 class="card-title">Portfolio Value</h5>
                  <p class="card-text" id="porfolio-value"></p>
                </div>
              </div>

              <div class="card bg-dark mb-3 mx-3" style="max-width: 18rem;">
                <div class="card-body">
                  <h5 class="card-title"> Profit & Loss</h5>
                  <p class="card-text" id="profit-loss"> </p>
                </div>
              </div>

              <div class="card bg-dark mb-3 mx-3" style="max-width: 18rem;">
                <div class="card-body">
                  <h5 class="card-title"> Cash Balance </h5>
                  <p class="card-text" id="cash-balance"></p>
                </div>
              </div>
        </div>
        </div>
      </div>

    <h3> Your Stock Portfolio </h3>
    <div class="container">
        <table class="table table-dark" id="tableId">
            <thead> 
        
                <th scope = "col"> Symbol </th>
                <th scope = "col"> Price </th>
            </thead>
            <tbody id="bodyId"></tbody>
        </table>
    </div>

<script type="text/javascript">
    async function GetUpdates() {
        let response = await fetch('/get_dashboard_data');
        let data = await response.json();
        let html = '';
        for (let id in data) {
            let ticker = data[id].ticker
            let currentPrice = data[id].currentPrice
            html += `<tr> <td> ${ticker} </td> <td> ${currentPrice} </td> </tr>`;
                    
        }
        console.log(html);
        document.getElementById('bodyId').innerHTML = html;

    }

    async function setIntervalAndExecute(fn, t) {
        fn();
        setInterval(fn, t);
    }
    setIntervalAndExecute(GetUpdates, 300000);
</script>
{% endblock %}