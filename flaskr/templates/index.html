{% extends "layout.html" %}

{% block main %}
    <h3> Portfolio Summary </h3>
    <div class="container">
        <div class="row justify-content-md-center">
            <div class="card bg-dark mb-5 mx-3" style="max-width: 18rem;">
                <div class="card-body">
                    <h5 class="card-title">Portfolio Value</h5>
                <p class="card-text" id="porfolio-value">
                  <h5> {{ "$%.2f" | format(portfolio['portfolio_value']) }} </h5>
                </p>
                </div>
              </div>

              <div class="card bg-dark mb-5 mx-3" style="max-width: 18rem;">
                <div class="card-body">
                  <h5 class="card-title"> Profit & Loss</h5>
                  <p class="card-text" id="profit-loss"> 
                    <h5> {{ "$%.2f" | format(portfolio['profit'])  }}</h5>
                    <h5> ({{ "%.2f%%" | format(portfolio['percentage_change']) }})</h5>
                  </p>
                </div>
              </div>

              <div class="card bg-dark mb-5 mx-3" style="max-width: 18rem;">
                <div class="card-body">
                  <h5 class="card-title"> Cash Balance </h5>
                  <p class="card-text" id="cash-balance">
                    <h5> {{ "$%.2f" | format(portfolio['cash']) }} </h5>
                  </p>
                </div>
              </div>
        </div>
        </div>
      </div>

      <div class="container">
        <div class="row justify-content-md-center">
          <div class="card text-white bg-dark mb-3 w-50 mx-3">
            <div class="card-header">
              <h5> Your Stocks </h5>
            </div>
            <div class="card-body">
              <table class="table table-dark" id="tableId">
                <thead> 
            
                    <th scope = "col"> Symbol </th>
                    <th scope = "col"> Shares </th>
                    <th scope = "col"> Price </th>
                    <th scope = "col"> Change </th>
                </thead>
                <tbody id="bodyId">
                  {% if portfolio %}
                  {% for stock in portfolio['stocks'] %}
                  <tr>
                      <td class="text-center">{{ stock['symbol'] }}</td>
                      <td class="text-center"> {{ stock['shares'] }}</td>
                      <td class="text-center"> {{ "$%.2f" | format(stock['current_price'])  }}</td>
                      <td class="text-center"> {{ "%.2f%%" | format(stock['change'])  }}</td>
                  </tr>
                  {% endfor %}
                  {% endif %}
                </tbody>
            </table>
            </div>
          </div>
      
          <div class="card bg-dark mb-5 w-25">
            <div class="card-body">
              <h5 class="card-title"> Indexes </h5>
              <table class="table table-dark" id="indexTableId">
                <thead> 
            
                    <th scope = "col"> Symbol </th>
                    <th scope = "col"> Price </th>
                    <th scope = "col"> Change </th>
                </thead>
                <tbody id="indexBodyId">
                  {% if indexes  %}
                  {% for index in indexes %}
                  <tr>
                      <td class="text-center">{{ index['symbol'] }}</td>
                      <td class="text-center" id="{{index['symbol']}}-price"> {{ "$%.2f" | format(index['current_price'])  }}</td>
                      <td class="text-center"> {{ "%.2f%%" | format(index['change'])  }}</td>
                  </tr>
                  {% endfor %}
                  {% endif %}
                </tbody>
            </table>
            </div>
          </div>
        </div>
      </div>

    
<script type="text/javascript">
  
  /*
    async function GetUpdates() {
        let response = await fetch('/get_dashboard_data');
        let data = await response.json();
        let html = '';
        for (let id in data) {
            let ticker = data[id].ticker
            let currentPrice = data[id].currentPrice
            html += `<tr> <td> ${ticker} </td> <td> ${currentPrice} </td> </tr>`;
                    
        }
        console.log(html);
        document.getElementById('bodyId').innerHTML = html;

    }

    async function setIntervalAndExecute(fn, t) {
        fn();
        setInterval(fn, t);
    }
    setIntervalAndExecute(GetUpdates, 300000);
    */
</script>
{% endblock %}